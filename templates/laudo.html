<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Laudo Técnico</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style_laudo.css') }}">
</head>
<body>

    <div class="form-container" id="conteudo-para-pdf">
        <header class="header">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo WS Piscinas" class="header-logo">
            <div class="company-info">
                <strong>WS Piscinas caça vazamentos</strong>
                <p>CNPJ: 25016679000138</p>
                <p>R Santa Catarina 583</p>
                <p>Telefone: 19981639852</p>
                <p>E-mail: welsantospiscina@gmail.com</p>
            </div>
        </header>
        <div class="inline-container">
            <div class="info-box-inline">
                <input type="number" placeholder="Laudo nº" class="campo-limpavel">
            </div>
            <div class="info-box-inline">
                <label>Data:</label>
                <input type="date" class="campo-limpavel">
            </div>
        </div>
        <fieldset class="field-box">
            <legend>Cliente</legend>
            <input type="text" placeholder="Digite aqui" class="campo-limpavel">
        </fieldset>
        <fieldset class="field-box">
            <legend>Endereço</legend>
            <input type="text" placeholder="Digite aqui" class="campo-limpavel">
        </fieldset>
        <div class="field-group">
            <fieldset class="field-box">
                <legend>Fone</legend>
                <input type="number" placeholder="Digite aqui" class="campo-limpavel">
            </fieldset>
            <fieldset class="field-box">
                <legend>CPF</legend>
                <input type="number" placeholder="Digite aqui" class="campo-limpavel">
            </fieldset>
        </div>
        <div id="servicos-container">
            <div class="service-table">
                <div class="table-cell">
                    <label>Serviço nº:</label>
                    <span class="servico-numero">1</span>
                </div>
                <div class="table-cell">
                    <label>Tipo:</label>
                    <input type="text" placeholder="Inspeção em piscina" class="campo-limpavel">
                </div>
                <div class="table-cell">
                    <label>Valor:</label>
                    <input type="number" placeholder="Digite aqui" class="servico-valor campo-limpavel">
                </div>
            </div>
        </div>
        <fieldset class="field-box description-box">
            <legend>Descrição</legend>
            <div contenteditable="true" class="textarea campo-limpavel-div"></div>
        </fieldset>
        <div class="galeria-fotos" id="galeria-fotos">
            <label for="input-foto" class="botao-add-foto">
                +
                <input type="file" id="input-foto" accept="image/*" multiple>
            </label>
        </div>
        <div class="total-container">
            <div class="info-box-total">
                <label>Valor total:</label>
                <input type="number" id="valor-total-input" readonly>
            </div>
        </div>
        <div class="assinaturas">
            <div class="assinatura-block">
                <div class="assinatura-imagem">
                    <img src="{{ url_for('static', filename='ass.png') }}" alt="Assinatura do Técnico" class="assinatura-img">
                </div>
                <div class="linha-assinatura-texto">
                    Técnico Responsável
                </div>
            </div>
            <div class="assinatura-block">
                <div class="assinatura-imagem">
                </div>
                <div class="linha-assinatura-texto">
                    Nome do(a) cliente
                </div>
            </div>
        </div>
    </div>
    <div class="action-buttons" id="botoes-acao">
        <button id="adicionar-servico-btn" class="btn btn-blue">Adicionar serviço</button>
        <button id="limpar-campos-btn" class="btn btn-gray">Limpar Campos</button>
        <button id="gerar-pdf-btn" class="btn btn-green">Gerar PDF</button>
    </div>
    <script>
        const inputFoto = document.getElementById('input-foto');
        const galeriaFotos = document.getElementById('galeria-fotos');
        let contadorFotos = 0;
        inputFoto.addEventListener('change', (event) => {
            const files = event.target.files;
            for (const file of files) {
                contadorFotos++;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const fotoItem = document.createElement('div');
                    fotoItem.classList.add('foto-item');
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    const p = document.createElement('p');
                    p.textContent = `foto nº ${contadorFotos}`;
                    fotoItem.appendChild(img);
                    fotoItem.appendChild(p);
                    galeriaFotos.insertBefore(fotoItem, galeriaFotos.lastElementChild);
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('gerar-pdf-btn').addEventListener('click', () => { window.print(); });

        let servicoContador = 1;
        const adicionarBtn = document.getElementById('adicionar-servico-btn');
        const servicosContainer = document.getElementById('servicos-container');
        function adicionarServico() {
            servicoContador++;
            const novoServicoDiv = document.createElement('div');
            novoServicoDiv.classList.add('service-table');
            novoServicoDiv.innerHTML = `
                <div class="table-cell">
                    <label>Serviço nº:</label>
                    <span class="servico-numero">${servicoContador}</span>
                </div>
                <div class="table-cell">
                    <label>Tipo:</label>
                    <input type="text" placeholder="Novo serviço" class="campo-limpavel">
                </div>
                <div class="table-cell">
                    <label>Valor:</label>
                    <input type="number" placeholder="Digite aqui" class="servico-valor campo-limpavel">
                </div>
            `;
            servicosContainer.appendChild(novoServicoDiv);
            adicionarListenersDeCalculo();
        }
        adicionarBtn.addEventListener('click', adicionarServico);

        function atualizarValorTotal() {
            let total = 0;
            const todosOsValores = document.querySelectorAll('.servico-valor');
            todosOsValores.forEach(input => {
                total += parseFloat(input.value) || 0;
            });
            const totalInput = document.getElementById('valor-total-input');
            totalInput.value = total.toFixed(2);
        }
        function adicionarListenersDeCalculo() {
            const todosOsValores = document.querySelectorAll('.servico-valor');
            todosOsValores.forEach(input => {
                input.addEventListener('input', atualizarValorTotal);
            });
        }

        const limparBtn = document.getElementById('limpar-campos-btn');
        function limparCampos() {
            document.querySelectorAll('.campo-limpavel').forEach(input => input.value = '');
            document.querySelectorAll('.campo-limpavel-div').forEach(div => div.innerHTML = '');
            while (servicosContainer.children.length > 1) {
                servicosContainer.removeChild(servicosContainer.lastChild);
            }
            document.querySelectorAll('.foto-item').forEach(item => item.remove());
            servicoContador = 1;
            contadorFotos = 0;
            atualizarValorTotal();
        }
        limparBtn.addEventListener('click', limparCampos);

        window.onload = () => {
            adicionarListenersDeCalculo();
        };
    </script>
</body>
</html>